#!/usr/bin/perl
#
#A simple install script for EUPS
#
# Nikhil Padmanabhan
# Princeton, 1.25.2003
#EUPS : A Unix Versioning System
#Copyright (C) 2003 Nikhil Padmanabhan

#    This program is free software; you can redistribute it and/or
#modify it under the terms of the GNU General Public License
#    as published by the Free Software Foundation; either version 2
#of the License, or (at your option) any later version.

#This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.

#You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.

###############################

use File::Spec::Functions;

$syntax = "install <eups dir> <prod_dir_prefix>\n";

$eupsdir = $ARGV[0];
$prefix = $ARGV[1];
$db = $prefix . "/ups_db";

die "$syntax" if ($eupsdir eq "");
die "$syntax" if ($prefix eq "");
die "$syntax" if ($db eq "");

print "Installing EUPS:\n";
print "EUPS directory:      $eupsdir\n";
print "EUPS database:       $db\n";
print "Products location:   $prefix\n";

$bindir = catfile('$EUPS_DIR',"bin");
$binname = catfile('$EUPS_DIR',"bin","eups_setup");

print "Writing a csh startup script\n";
open FILE, ">setups.csh" or die "Unable to open setups.csh";
print FILE <<"EOT";
if ("\$EUPS_DIR" != "" ) then
   setenv PATH `echo \$PATH | perl -pe "s|:$bindir||g"`
endif

setenv EUPS_DIR $eupsdir
setenv EUPS_PATH $prefix
# Deprecated variables
unsetenv PROD_DIR_PREFIX
unsetenv PRODUCTS

setenv PATH \${PATH}:$bindir

alias setup 'source `$binname setup \\!*`'
alias unsetup 'source `$binname unsetup \\!*`'
EOT
close FILE;

print "Writing a sh startup script\n";
open FILE, ">setups.sh" or die "Unable to open setups.sh";
print FILE <<"EOT";
if [ "\$EUPS_DIR" != "" ]; then
   PATH=`echo \$PATH | perl -pe "s|:$bindir||g"`
fi

export EUPS_DIR=$eupsdir
export EUPS_PATH=$prefix
# Deprecated variables
unset PROD_DIR_PREFIX
unset PRODUCTS

export PATH="\$PATH:$bindir"

function setup   { source `$binname setup \$@`; };   export -f setup
function unsetup { source `$binname unsetup \$@`; }; export -f unsetup
EOT
    
close FILE;

exit 0;
