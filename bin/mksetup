#!/usr/bin/perl
#
#A simple install script for EUPS
#
# Nikhil Padmanabhan
# Princeton, 1.25.2003
#EUPS : A Unix Versioning System
#Copyright (C) 2003 Nikhil Padmanabhan

#    This program is free software; you can redistribute it and/or
#modify it under the terms of the GNU General Public License
#    as published by the Free Software Foundation; either version 2
#of the License, or (at your option) any later version.

#This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.

#You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.

###############################

use File::Spec::Functions;

$syntax = "install <eups dir> <prod_dir_prefix> <product database>\n";

$eupsdir = $ARGV[0];
$prefix = $ARGV[1];
$db = $ARGV[2];
if ($db ne "") {
   $have_products = 1;
} else {
   $have_products = 0;
   $db = $prefix . "/ups_db";
}

die "$syntax" if ($eupsdir eq "");
die "$syntax" if ($prefix eq "");
die "$syntax" if ($db eq "");

print "Installing EUPS:\n";
print "EUPS directory:      $eupsdir\n";
print "EUPS database:       $db\n";
print "Products location:   $prefix\n";

$sleep = 5;
print "This will start in $sleep seconds.........\n";
sleep $sleep;

print "Writing a csh startup script\n";
open FILE, ">setups.csh" or die "Unable to open setups.csh";
print FILE "setenv EUPS_DIR $eupsdir \n";
print FILE "setenv PROD_DIR_PREFIX $prefix\n";
if ($have_products) {
   print FILE "setenv PRODUCTS $db\n";
}
$bindir = catfile($eupsdir,"bin");
print FILE "setenv PATH $bindir:\$PATH\n";
$binname = catfile($eupsdir,"bin","eups_setup");
print FILE "alias setup \'source \`$binname setup \\!*\`\'\n";
print FILE "alias unsetup \'source \`$binname unsetup \\!*\`\'\n";
close FILE;

print "Writing a sh startup script\n";
open FILE, ">setups.sh" or die "Unable to open setups.sh";
print FILE "export EUPS_DIR=$eupsdir \n";
print FILE "export PROD_DIR_PREFIX=$prefix\n";
if ($have_products) {
   print FILE "export PRODUCTS=$db\n";
}
print FILE "export PATH=\"\$PATH:$bindir\"\n";
print FILE "function setup { source \`$binname setup \$\@\`; }\n";
print FILE "function unsetup { source \`$binname unsetup \$\@\`; }\n";
print FILE "export -f setup"
print FILE "export -f unsetup"
close FILE;

exit 0;
