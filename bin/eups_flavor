#!/usr/bin/perl
#
# Returns the version of a currently installed product
# If used with -a, also returns the flavor and version file used to install it
# 
# Syntax : eups_flavor [-a] <product>
#
# Nikhil Padmanabhan, Princeton
# Jan 16, 2003
#
#EUPS : A Unix Versioning System
#Copyright (C) 2003 Nikhil Padmanabhan

#    This program is free software; you can redistribute it and/or
#modify it under the terms of the GNU General Public License
#    as published by the Free Software Foundation; either version 2
#of the License, or (at your option) any later version.

#This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.

#You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.

#################################

use File::Spec::Functions;


$debug = $ENV{"EUPS_DEBUG"};
$debug = 0 if ($debug eq "");

$prod = join " ", @ARGV;
if ($prod =~ m/\-v/) {
    $prod =~ s/\-v//;
    $debug = 1;
}
@prod = split " ",$prod;

$prod = $prod[0];
$all = 0;
if ($prod eq "-a") {
    $all = 1;
    $prod = $prod[1];
}
$prod2 = $prod;

die "ERROR: No product specified\n Syntax : eups_flavor [-a] <product>\n" if ($prod eq "");

$prod =~ tr/a-z/A-Z/;
$str = "SETUP_$prod";
$args = $ENV{$str};
print STDERR "ERROR: $str not defined \n" if (($args eq "")&&($debug > 1));
exit if ($args eq "");

# Now parse the string
($prod, $vers, $flavor, $z, $db) = ($args =~ /^\s*(\S+)\s+(\S*)\s*-f\s+(\S+)\s+-([zZ])\s+(\S+)/);

if ($z eq "Z") {
   $db = catfile($db, "ups_db");
}

if (0) {
   die "ERROR: Missing VERSION information in $str\n" if ($vers eq "");
   die "ERROR: Missing FLAVOR information in $str\n" if ($flavor eq "");
   die "ERROR: Missing DATABASE information in $str\n" if ($db eq "");
}

print "$vers";
print ":$flavor:$db" if ($all == 1);
print "\n";

exit;
