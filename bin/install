#!/usr/local/bin/perl
#
#A simple install script for EvilUPS
#
# Nikhil Padmanabhan
# Princeton, 1.25.2003
###############################

use File::Spec::Functions;

$syntax = "install <evilups dir> <prod_dir_prefix> <product database>\n";

$eupsdir = $ARGV[0];
$prefix = $ARGV[1];
$db = $ARGV[2];

die "$syntax" if ($eupsdir eq "");
$eupsdir = catfile($eupsdir,"EvilUPS");
die "$syntax" if ($prefix eq "");
die "$syntax" if ($db eq "");

print "EvilUPS - Nikhil Padmanabhan\n";
print "Installing:\n";
print "EvilUPS directory  : $eupsdir\n";
print "EvilUPS database   : $db\n";
print "Products location  : $prefix\n";

print "This will start in 30 seconds.........\n";
#sleep 30;

print "Writing a csh startup script\n";
open FILE, ">setups.csh" or die "Unable to open setups.csh";
print FILE "setenv EUPS_DIR $eupsdir \n";
print FILE "setenv PROD_DIR_PREFIX $prefix\n";
print FILE "setenv PRODUCTS $db\n";
$binname = catfile($eupsdir,"bin","evilsetup");
print FILE "alias setup \'source \`$binname setup \\!*\`\'\n";
print FILE "alias unsetup \'source \`$binname unsetup \\!*\`\'\n";
close FILE;

print "Writing a sh startup script\n";
open FILE, ">setups.sh" or die "Unable to open setups.sh";
print FILE "export EUPS_DIR=$eupsdir \n";
print FILE "export PROD_DIR_PREFIX=$prefix\n";
print FILE "export PRODUCTS=$db\n";
print FILE "function setup { source \`$binname setup \$\@\`; }\n";
print FILE "function unsetup { source \`$binname unsetup \$\@\`; }\n";
close FILE;

print "Now creating $eupsdir  ..... \n";
system ("mkdir -p $eupsdir");
die "ERROR : Cannot create directory $eupsdir\n" if (!(-d $eupsdir));

$qaz = catfile ("..","*");
$comm = "cp -R $qaz $eupsdir";
print "$comm\n";
system "$comm";

print "Setup successful!\n";

exit;

